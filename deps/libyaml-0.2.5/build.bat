@echo off

set YAML_VERSION_MAJOR=0
set YAML_VERSION_MINOR=2
set YAML_VERSION_PATCH=5
set YAML_VERSION_STRING=%YAML_VERSION_MAJOR%.%YAML_VERSION_MINOR%.%YAML_VERSION_PATCH%

set BL_YAML_SRC_DIR=%BL_DEPS_DIR%\libyaml-0.2.5\src
set BL_YAML_BUILD_DIR=%BL_BUILD_DIR%\libyaml

if not exist "%BL_YAML_BUILD_DIR%" (
    mkdir "%BL_YAML_BUILD_DIR%"
)

set BL_YAML_INCLUDE_DIR=%BL_DEPS_DIR%\libyaml-0.2.5\include
set BL_YAML_SRC_FILES=^
 "%BL_YAML_SRC_DIR%\api.c"^
 "%BL_YAML_SRC_DIR%\dumper.c"^
 "%BL_YAML_SRC_DIR%\emitter.c"^
 "%BL_YAML_SRC_DIR%\loader.c"^
 "%BL_YAML_SRC_DIR%\parser.c"^
 "%BL_YAML_SRC_DIR%\reader.c"^
 "%BL_YAML_SRC_DIR%\scanner.c"^
 "%BL_YAML_SRC_DIR%\writer.c"

set BL_YAML_INCLUDE=/I"%BL_YAML_INCLUDE_DIR%"

set BL_YAML_FLAGS=^
 %BL_BASE_FLAGS%^
 /DYAML_VERSION_MAJOR=%YAML_VERSION_MAJOR%^
 /DYAML_VERSION_MINOR=%YAML_VERSION_MINOR%^
 /DYAML_VERSION_PATCH=%YAML_VERSION_PATCH%^
 /DYAML_VERSION_STRING="\"%YAML_VERSION_STRING%"\"^
 /DYAML_DECLARE_STATIC

cd %BL_YAML_BUILD_DIR%
"%BL_CL%" /nologo /c %BL_YAML_SRC_FILES% /std:c11 /I"%INCLUDE%" %BL_YAML_INCLUDE% %BL_YAML_FLAGS%
cd %BL_BUILD_DIR%
lib /nologo /OUT:yaml.lib "%BL_YAML_BUILD_DIR%\*.obj"
cd %BL_ROOT_DIR%